name: Render keepalive ping

on:
  schedule:
    # Every 5 minutes
    - cron: "*/5 * * * *"
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2

    steps:
      - name: Validate configuration
        run: |
          if [ -z "${{ secrets.RENDER_HEALTH_URLS }}" ]; then
            echo "Missing secret: RENDER_HEALTH_URLS"
            exit 1
          fi

      - name: Ping Render health endpoints
        run: |
          set -euo pipefail
          urls="${{ secrets.RENDER_HEALTH_URLS }}"
          echo "Pinging configured endpoints..."

          # Support newline-separated or comma-separated URLs.
          echo "$urls" | tr ',' '\n' | while read -r url; do
            url="$(echo "$url" | xargs)"
            if [ -z "$url" ]; then
              continue
            fi
            echo "- $url"
            curl --fail --silent --show-error --max-time 20 "$url" | head -c 500
            echo ""
          done
